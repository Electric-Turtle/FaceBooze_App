{% extends "base.html" %}

{% block content %}

<div class="container" style="margin-top:50px; margin-bottom:50px;">


{% for recipe in query %}

	<p id="recipe-id" style="display:none;">{{recipe.recipe_id}}</p>

	<div class="row">
		<div class="col-md-6">
			<h2>{{ recipe.title }}</h2>
		</div>
		<div class="col-md-6">
			<h2 style="float:right" id="availablityLabel">
			{% if recipe.available %}
				<button class="btn btn-success">AVAILABLE</button>
			{% else %}
				<button class="btn btn-danger">UNAVAILABLE</button>
			{% endif %}
			</h2>
		</div>
	</div>

	<hr>

	<h4>Directions: {{recipe.directions}}</h4>

	<h5>Serving Size: {{recipe.serving_size}}</h5>
	<h5>Cuisine Type: {{ recipe.cuisine_type}}</h5>
	<h5>Price: $ {{recipe.price}}</h5>
	<br>
	{% if recipe.recipe_id in supplierRecipes %}
		{% if recipe.available %}
			<button name="availability" class="btn btn-primary">Make Unavailable</button>
		{% else %}
			<button name="availability" class="btn btn-primary">Make Available</button>
		{% endif %}
	{% endif %}

{% endfor %}


</div>

<script>
	$( document ).ready(function() {
		console.log("Document is ready");
		$('button[name=availability]').on('click',function(e){
			console.log("clicked!");
			if($('button[name=availability]').text() == 'Make Available') {
				$.ajax({
			        url: '/ajax/available/recipe',
			        data: {
			          'q': $('#recipe-id').text()
			        },
			        success: function (data) {
			        	console.log("Success!");
			        	$('button[name=availability]').html('Make Unavailable');
			        	$('#availablityLabel').html('<button class="btn btn-success">AVAILABLE</button>');
			        }
			    }); 
			}
			else {
				$.ajax({
			        url: '/ajax/unavailable/recipe',
			        data: {
			          'q': $('#recipe-id').text()
			        },
			        success: function (data) {
			        	console.log("Success!");
			        	$('button[name=availability]').html('Make Available');
			        	$('#availablityLabel').html('<button class="btn btn-danger">UNAVAILABLE</button>');
			        }
			    });
			}
		});
	});
</script>

{% endblock %}